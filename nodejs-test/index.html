<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
    <style>
        h5 {
            color: red;
        }
    </style>
</head>

<body>
    <h5>您的账户余额是：<span id="amount">&&&amount&&&</span></h5>
    <button id="button">打钱</button>
    <script>
        button.addEventListener('click', (e) => {
            $.ajax({
                url: "/pay",
                dataType: "jsonp",
                success: function (response) {
                    if (response === 'success') {
                        amount.innerText = amount.innerText - 1
                    }
                }
            })
        





















            // let script = document.createElement('script')
            // let functionName = 'abcds'+parseInt(Math.random()*100000,10)
            // //十进制随机正整数，形如：abcds647379779734327   的随机函数名
            // window[functionName] = function(result){
            //     if(result === 'success'){
            //         amount.innerText = amount.innerText - 1
            //     }else{}
            // }
            // script.src = '/pay?callback='+functionName
            // document.body.appendChild(script)
            // script.onload = function(e){
            //     e.currentTarget.remove()
            //     delete window[functionName]   //每次用完函数名，删掉，每一次就会是生成新的名字，不会重复，这样也不会污染全局变量
            // }
            // script.onerror = function(){
            //     alert('打钱失败')
            //     e.currentTarget.remove()
            //     delete window[functionName]
            // }
        })











        //       let image = document.createElement('img')
        //       image.src = '/pay'
        //       image.onload = function(){
        //           alert('打钱成功')
        //           amount.innerText=amount.innerText - 1
        //       }
        //       image.onerror = function(){
        //           alert('打钱失败')
        //       }
        //   })


        // button.addEventListener('click', (e) => {
        //     let n = amount.innerText
        //     let number = parseInt(n, 10)
        //     let nuwNumber = number - 1
        //     amount.innerText = nuwNumber
        // })
    </script>
    <script src="/server.js"></script>
</body>

</html>